{
  "openapi": "3.0.0",
  "info": {
    "title": "NFPA Validator API",
    "description": "Validate fire sprinkler designs against NFPA 13 (2025 Edition) requirements",
    "version": "1.0.0"
  },
  "paths": {
    "/validate-design": {
      "post": {
        "operationId": "validateDesign",
        "summary": "Validate complete sprinkler design against NFPA 13",
        "description": "Performs comprehensive compliance check including spacing, coverage, hydraulics, and obstruction rules",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["hazard_class", "sprinkler_layout"],
                "properties": {
                  "hazard_class": {
                    "type": "string",
                    "enum": ["Light", "Ordinary Group 1", "Ordinary Group 2", "Extra Group 1", "Extra Group 2"],
                    "description": "Occupancy hazard classification per NFPA 13 Chapter 5"
                  },
                  "sprinkler_layout": {
                    "type": "object",
                    "properties": {
                      "sprinkler_type": {
                        "type": "string",
                        "enum": ["standard_spray_upright", "standard_spray_pendent", "sidewall", "extended_coverage", "esfr", "residential"]
                      },
                      "k_factor": {
                        "type": "number",
                        "description": "K-factor of sprinkler heads"
                      },
                      "positions": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "id": { "type": "string" },
                            "x": { "type": "number" },
                            "y": { "type": "number" },
                            "z": { "type": "number" },
                            "deflector_to_ceiling_inch": { "type": "number" }
                          }
                        }
                      },
                      "spacing_ft": {
                        "type": "number",
                        "description": "Typical spacing between heads"
                      },
                      "coverage_sqft_per_head": {
                        "type": "number"
                      }
                    }
                  },
                  "ceiling_construction": {
                    "type": "string",
                    "enum": ["smooth", "beam_and_girder", "bar_joist", "concrete_tee", "wood_truss"],
                    "description": "Ceiling construction type"
                  },
                  "ceiling_height_ft": {
                    "type": "number"
                  },
                  "obstructions": {
                    "type": "array",
                    "description": "List of obstructions that may affect coverage",
                    "items": {
                      "type": "object",
                      "properties": {
                        "type": { "type": "string" },
                        "width_inch": { "type": "number" },
                        "depth_inch": { "type": "number" },
                        "distance_from_sprinkler_inch": { "type": "number" }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Validation completed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["COMPLIANT", "NON_COMPLIANT", "NEEDS_REVIEW"]
                    },
                    "traffic_light": {
                      "type": "string",
                      "enum": ["GREEN", "YELLOW", "RED"]
                    },
                    "violations": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "rule_id": { "type": "string" },
                          "nfpa_section": { "type": "string" },
                          "severity": { "type": "string", "enum": ["CRITICAL", "MAJOR", "MINOR"] },
                          "description": { "type": "string" },
                          "affected_elements": { "type": "array", "items": { "type": "string" } },
                          "remediation": { "type": "string" }
                        }
                      }
                    },
                    "warnings": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "nfpa_section": { "type": "string" },
                          "message": { "type": "string" }
                        }
                      }
                    },
                    "compliance_score": {
                      "type": "number",
                      "description": "Compliance percentage (100 = fully compliant)",
                      "minimum": 0,
                      "maximum": 100
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/check-spacing": {
      "post": {
        "operationId": "checkSpacing",
        "summary": "Validate sprinkler spacing per NFPA 13 Table 10.2.1-10.2.3",
        "description": "Checks minimum and maximum spacing requirements based on hazard class",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["hazard_class", "sprinkler_positions"],
                "properties": {
                  "hazard_class": {
                    "type": "string",
                    "enum": ["Light", "Ordinary Group 1", "Ordinary Group 2", "Extra Group 1", "Extra Group 2"]
                  },
                  "sprinkler_positions": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "id": { "type": "string" },
                        "x": { "type": "number" },
                        "y": { "type": "number" }
                      }
                    }
                  },
                  "wall_positions": {
                    "type": "array",
                    "description": "Wall boundary coordinates for distance-to-wall checks",
                    "items": {
                      "type": "object",
                      "properties": {
                        "x1": { "type": "number" },
                        "y1": { "type": "number" },
                        "x2": { "type": "number" },
                        "y2": { "type": "number" }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Spacing check completed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["PASS", "FAIL"]
                    },
                    "min_spacing_required_ft": { "type": "number" },
                    "max_spacing_allowed_ft": { "type": "number" },
                    "max_distance_to_wall_ft": { "type": "number" },
                    "violations": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "sprinkler_id": { "type": "string" },
                          "issue": { "type": "string" },
                          "actual_value_ft": { "type": "number" },
                          "required_value_ft": { "type": "number" }
                        }
                      }
                    },
                    "nfpa_reference": {
                      "type": "string",
                      "description": "NFPA 13 section reference"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/query-requirement": {
      "get": {
        "operationId": "queryRequirement",
        "summary": "Query specific NFPA 13 requirement",
        "description": "Returns code requirement details for a given topic or section number",
        "parameters": [
          {
            "name": "section",
            "in": "query",
            "description": "NFPA 13 section number (e.g., 10.2.1, 8.6.2)",
            "required": false,
            "schema": { "type": "string" }
          },
          {
            "name": "topic",
            "in": "query",
            "description": "Topic to query (e.g., 'light hazard spacing', 'obstruction rules')",
            "required": false,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Requirement details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "section": { "type": "string" },
                    "title": { "type": "string" },
                    "requirements": {
                      "type": "array",
                      "items": { "type": "string" }
                    },
                    "tables": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "table_id": { "type": "string" },
                          "data": { "type": "object" }
                        }
                      }
                    },
                    "israeli_standard_reference": {
                      "type": "string",
                      "description": "Related Israeli Standard ת\"י reference if applicable"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
